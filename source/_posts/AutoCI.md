---
title: ç§»åŠ¨ç«¯è‡ªåŠ¨åŒ– CI Review è§£å†³æ–¹æ¡ˆ
layout: post
date: 2019-01-26 12:55:38
comments: true
categories:
	- Summary
keywords: CI
tags:
	- Script
description: 
---

ä»‹ç»ä¸€ä¸‹é€šè¿‡ CodeBeat å¯¹ç§»åŠ¨ç«¯ä»£ç è´¨é‡çš„è‡ªåŠ¨åŒ–ç®¡ç†ï¼Œé¡ºå¸¦æåŠä¸€ä¸‹ï¼Œç¬¬ä¸‰æ–¹æŒç»­é›†æˆç¯å¢ƒ Travis CI çš„åŸºæœ¬ä½¿ç”¨~                                                                                                           
<!-- more -->

ä¹‹å‰ä¸€ç¯‡æ–‡ç« ä»‹ç»å¦‚ä½•é€šè¿‡ Jenkins + Fastlane è„šæœ¬è‡ªåŠ¨æ‰“åŒ…å‘å¸ƒæµ‹è¯•åŒ…ã€‚

*  [Jenkins + Fastlane è‡ªåŠ¨æ‰“åŒ…è„šæœ¬](https://reversescale.github.io/2017/06/20/AutoBuildScript/)

è¿™æ¬¡ä¸»è¦ä»‹ç»é€šè¿‡ CodeBeat å¯¹ç§»åŠ¨ç«¯ä»£ç è´¨é‡çš„è‡ªåŠ¨åŒ–ç®¡ç†ï¼Œé¡ºå¸¦æåŠä¸€ä¸‹ï¼Œç¬¬ä¸‰æ–¹æŒç»­é›†æˆç¯å¢ƒ Travis CI çš„åŸºæœ¬ä½¿ç”¨ã€‚

![kEed4f.png](https://s2.ax1x.com/2019/01/23/kEed4f.png)


â–ˆâ—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â–ˆ

## ğŸš  ç¬¬ä¸‰æ–¹ CI æ—¶ä»£

> [ğŸš  ç¬¬ä¸‰æ–¹ CI æ—¶ä»£] Travis CI æ˜¯ä¸€ä¸ªä¸“é—¨ä¸ºå¼€æºé¡¹ç›®æ‰“é€ çš„æŒç»­é›†æˆç¯å¢ƒï¼ˆä»˜è´¹å¯ä»¥æ”¯æŒç§æœ‰é¡¹ç›®ï¼‰ï¼Œç›®å‰å·²ç»æ”¯æŒç»å¤§éƒ¨åˆ†ä¸»æµè¯­è¨€ï¼Œå®ƒçš„é…ç½®æ–‡ä»¶é‡‡ç”¨ yaml æ ¼å¼ï¼Œç®€æ´æ¸…æ–°ç‹¬æ ‘ä¸€å¸œã€‚]

### æŒç»­é›†æˆç¯å¢ƒèƒ½åšä»€ä¹ˆï¼Ÿ

![kEML90.png](https://s2.ax1x.com/2019/01/23/kEML90.png)

æŒç»­é›†æˆæ˜¯æ¶µç›–ä»£ç å˜æ›´åå¯¹é¡¹ç›®è¿›è¡Œè‡ªåŠ¨è¿è¡Œã€æµ‹è¯•åŠåé¦ˆè¿è¡Œç»“æœçš„æœåŠ¡ã€‚é€šè¿‡è‡ªåŠ¨åŒ–çš„ç›‘ç®¡ï¼Œä»¥æœ€å¤§ç¨‹åº¦ç¡®ä¿ä»£ç å˜æ›´ç¬¦åˆå¼€å‘é¢„æœŸã€‚

ä¸ä»…å¦‚æ­¤ï¼Œä¸€ä¸ªå®Œå–„çš„æŒç»­é›†æˆç¯å¢ƒè¿˜èƒ½å¤Ÿæ¸…æ™°ç»†åŒ–å¼€å‘è¿›åº¦ï¼Œä¼˜åŒ–è¿­ä»£å‘¨æœŸï¼Œæé«˜é¡¹ç›®è´¨é‡ã€‚

ä½†æ˜¯æ­å»ºæŒç»­é›†æˆç¯å¢ƒåŠé…å¥—æœåŠ¡é€šå¸¸éœ€è¦æ¶‰åŠå¤šæ–¹é¢çŸ¥è¯†ï¼Œè€Œä¸”åæœŸç»´æŠ¤ä¹Ÿéœ€è¦æ—¶é—´æˆæœ¬ã€‚

### Travis CI æœåŠ¡

![kEKkI1.png](https://s2.ax1x.com/2019/01/23/kEKkI1.png)

Travis CI æä¾›çš„æ˜¯æŒç»­é›†æˆæœåŠ¡ï¼ˆContinuous Integrationï¼Œç®€ç§° CIï¼‰ã€‚å®ƒç»‘å®š Github ä¸Šé¢çš„é¡¹ç›®ï¼Œåªè¦æœ‰æ–°çš„ä»£ç ï¼Œå°±ä¼šè‡ªåŠ¨æŠ“å–ã€‚ç„¶åï¼Œæä¾›ä¸€ä¸ªè¿è¡Œç¯å¢ƒï¼Œæ‰§è¡Œæµ‹è¯•ï¼Œå®Œæˆæ„å»ºï¼Œè¿˜èƒ½éƒ¨ç½²åˆ°æœåŠ¡å™¨ã€‚

![kElwee.png](https://s2.ax1x.com/2019/01/23/kElwee.png)

è€Œä¸” Travis èƒ½ä¸ GitHub çš„å¾ˆå¥½çš„ç»“åˆèµ·æ¥ï¼Œä¸ºæˆ‘ä»¬æä¾›å‹å¥½çš„å¼€å‘ä½“éªŒã€‚

[![kElTWq.md.png](https://s2.ax1x.com/2019/01/23/kElTWq.md.png)](https://imgchr.com/i/kElTWq)

### å¼€å§‹é›†æˆ

#### æ·»åŠ  Travis-CI é…ç½®æ–‡ä»¶

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ–°å»º .travis.yml æ–‡ä»¶ï¼Œé…ç½®ä¿¡æ¯å¦‚ä¸‹ï¼š

> åœ¨ macOS ä¸‹ï¼Œä»¥ `.` å¼€å¤´çš„æ–‡ä»¶é»˜è®¤ä¸ºéšè—æ–‡ä»¶ï¼Œåœ¨ Finder ä¸­ä½¿ç”¨å¿«æ·é”® `Command + Shift + .` å¯ä»¥æ˜¾ç¤º / éšè—å¯¹éšè—æ–‡ä»¶çš„æ˜¾ç¤ºã€‚

```
# Xcode çš„å¤§ç‰ˆæœ¬å·ï¼Œæ ¹æ®å®é™…ç‰ˆæœ¬é…ç½®ï¼Œå¦‚æœæ˜¯ Swift é¡¹ç›®è¦æ³¨æ„ä¸åŒ Xcode ç‰ˆæœ¬å¯¹ Swift çš„æ”¯æŒ
osx_image: xcode10

# é»˜è®¤è®¾ç½® objective-c å³å¯ï¼ŒSwift é¡¹ç›®å¯ä»¥è®¾ç½® `swift`ï¼Œä½†æ˜¯å¹¶ä¸å½±å“è¿è¡Œ
language: objective-c

# ç¯å¢ƒå˜é‡
  # XCODE_PROJECTï¼šXcode å·¥ç¨‹æ–‡ä»¶è·¯å¾„
  # SCHEMEï¼šéœ€è¦æ‰§è¡Œçš„ Scheme
env:
  global:
    - LANG=en_US.UTF-8
    - LC_ALL=en_US.UTF-8
    - XCODE_PROJECT=CollectionIndexTools/CollectionIndexTools.xcodeproj
  matrix:
    - SCHEME="CollectionIndexTools"

# åœ¨ before_install æ­¥éª¤ä¸­ï¼Œæ‚¨å¯ä»¥å®‰è£…é¡¹ç›®æ‰€éœ€çš„å…¶ä»–ä¾èµ–é¡¹ï¼Œå¦‚ Ubuntu åŒ…æˆ–è‡ªå®šä¹‰æœåŠ¡
before_install:
  - gem install xcpretty --no-rdoc --no-ri --no-document --quiet

# éœ€è¦æ‰§è¡Œçš„æ„å»ºè„šæœ¬ï¼Œä½¿ç”¨ CocoaPods è¿›è¡Œåº“ç®¡ç†å¯ä»¥åŠ ä¸€å¥ `pod install`ï¼Œbuild å‘½ä»¤ä½¿ç”¨ `- xcodebuild -workspace "$XCODE_PROJECT" -scheme "$SCHEME" -configuration Debug -sdk iphonesimulator clean`
script:
  - set -o pipefail
  - xcodebuild -project "$XCODE_PROJECT" -scheme "$SCHEME" -configuration Debug clean build CODE_SIGN_IDENTITY="" CODE_SIGNING_REQUIRED=NO | xcpretty -c

# æ„å»ºé€šè¿‡åçš„è‡ªå®šä¹‰å‘½ä»¤
  # sleep 3ï¼šå»¶æ—¶ 3 ç§’ï¼Œè§„é¿ Travis-CI çš„å†å² Bug
after_success:
  - sleep 3
```

å¦‚æœæ˜¯ Swift é¡¹ç›®ï¼Œéœ€è¦é¢å¤–æ–°å»º .swift-version æ–‡ä»¶é…ç½® Swift ç‰ˆæœ¬å·ã€‚

```
4.2
```

#### æ³¨å†Œè´¦æˆ·

è®¿é—® [Travis CI å®˜ç½‘](https://travis-ci.org) åˆ›å»ºè´¦æˆ·æˆ–è€…é€šè¿‡ Github è´¦æˆ·ç›´æ¥ç™»å½•ï¼ŒTravis CI å¯¹ Github å¼€æºé¡¹ç›®æä¾›å…è´¹æœåŠ¡ã€‚

![kEUieP.png](https://s2.ax1x.com/2019/01/23/kEUieP.png)

ç‚¹å‡» `+` è¿›å…¥ GitHub é¡¹ç›®åŒæ­¥è®¾ç½®åˆ—è¡¨ï¼Œåˆ‡æ¢éœ€è¦åŒæ­¥çš„é¡¹ç›®ã€‚

[![kEU1oT.md.png](https://s2.ax1x.com/2019/01/23/kEU1oT.md.png)](https://imgchr.com/i/kEU1oT)

é»˜è®¤æƒ…å†µä¸‹ Travis CI ä¼šå®šæ—¶åŒæ­¥å¼€é€š Github ç»‘å®šçš„é¡¹ç›®ä»£ç ã€‚

[![kEUROI.md.png](https://s2.ax1x.com/2019/01/23/kEUROI.md.png)](https://imgchr.com/i/kEUROI)

é€šè¿‡ Travis CI æ§åˆ¶é¢æ¿å¯ä»¥è·å–åˆ°é¡¹ç›®çš„è¿è¡Œç»“æœã€log æ—¥å¿—å’Œé…ç½®æ–‡ä»¶ã€‚

[![kEaic9.md.png](https://s2.ax1x.com/2019/01/23/kEaic9.md.png)](https://imgchr.com/i/kEaic9)

è®¾ç½®å®Œæˆåå¯ä»¥åœ¨ Github å¯¹åº”é¡¹ç›®çš„ Setting - Integrations & services ä¸­ç®¡ç†ç»‘å®šçŠ¶æ€ã€‚

#### è¿è¡Œæµç¨‹

ä»ä¸Šé¢çš„ `.travis.yml` é…ç½®å¯çŸ¥ï¼Œé¡¹ç›®ä¼šåˆ†ä¸º installã€script ä¸¤ä¸ªé˜¶æ®µã€‚

* install é˜¶æ®µï¼šå®‰è£…ä¾èµ–
* script é˜¶æ®µï¼šè¿è¡Œè„šæœ¬

1)install å­—æ®µç”¨æ¥æŒ‡å®šå®‰è£…è„šæœ¬ã€‚

```
install: ./install-dependencies.sh
```

å¦‚æœæœ‰å¤šä¸ªè„šæœ¬ï¼Œå¯ä»¥å†™æˆä¸‹é¢çš„å½¢å¼ã€‚

```
install:
  - command1
  - command2
```

å¦‚æœä¸éœ€è¦å®‰è£…ï¼Œå³è·³è¿‡å®‰è£…é˜¶æ®µï¼Œå°±ç›´æ¥è®¾ä¸ºtrueã€‚

```
install: true
```

> åœ¨ install é˜¶æ®µï¼Œå¦‚æœ command1 å¤±è´¥äº†ï¼Œæ•´ä¸ªæ„å»ºå°±ä¼šåœæ­¢é€€å‡ºè¿›ç¨‹ã€‚

2)script å­—æ®µç”¨æ¥æŒ‡å®šæ„å»ºæˆ–æµ‹è¯•è„šæœ¬ã€‚

```
script: bundle exec thor build
```

å¦‚æœæœ‰å¤šä¸ªè„šæœ¬ï¼Œå¯ä»¥å†™æˆä¸‹é¢çš„å½¢å¼ã€‚

```
script:
  - command1
  - command2
```

> script é˜¶æ®µï¼Œå¦‚æœ command1 å¤±è´¥ï¼Œcommand2 ä¼šç»§ç»­æ‰§è¡Œã€‚ä½†æ˜¯ï¼Œæ•´ä¸ªæ„å»ºé˜¶æ®µçš„çŠ¶æ€æ˜¯å¤±è´¥ã€‚

å¦‚æœ command2 éœ€è¦ä¾èµ– command1 æˆåŠŸåæ‰èƒ½æ‰§è¡Œéœ€è¦å¦‚ä¸‹è®¾ç½®ï¼š

```
script: command1 && command2
```

#### è¿è¡ŒçŠ¶æ€

Travis æ¯æ¬¡è¿è¡Œè¿”å›çš„å››ç§çŠ¶æ€ï¼š
* passedï¼šè¿è¡ŒæˆåŠŸï¼Œé€€å‡ºç è¿”å›`0`
* canceledï¼šç”¨æˆ·å–æ¶ˆæ‰§è¡Œ
* erroredï¼šbefore_installã€installã€before_script æœ‰éé›¶é€€å‡ºç ï¼Œè¿è¡Œä¼šç«‹å³åœæ­¢
* failed ï¼šscript æœ‰éé›¶çŠ¶æ€ç ï¼Œä¼šç»§ç»­è¿è¡Œ

â–ˆâ—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â–ˆ

## ğŸ¤– è‡ªåŠ¨åŒ– Review æ—¶ä»£

> [ğŸ¤– è‡ªåŠ¨åŒ– Review æ—¶ä»£] CodeBeat æ˜¯ä¸€ä¸ªå…è´¹ä¸ºå¼€æºé¡¹ç›®è¿›è¡Œä»£ç è´¨é‡ç®¡ç†çš„å·¥å…·ï¼ˆä»˜è´¹å¯ä»¥æ”¯æŒç§æœ‰é¡¹ç›®ï¼‰ï¼Œæ— éœ€å¯¹åŸæœ‰é¡¹ç›®è¿›è¡Œä»»ä½•ä¿®æ”¹å³å¯è·å–é’ˆå¯¹é¡¹ç›®çš„å®Œæ•´è´¨é‡åˆ†æï¼Œæ–¹ä¾¿å¿«æ·ã€‚]

### Codebeat

![kErStx.png](https://s2.ax1x.com/2019/01/23/kErStx.png)

Codebeat æ˜¯ä¸€ä¸ªå¼€æºçš„è‡ªåŠ¨ä»£ç å®¡æŸ¥å·¥å…·ï¼Œæ”¯æŒRubyã€Goã€Swiftã€Java ä»£ç ç­‰å¼€å‘è¯­è¨€ã€‚å¹¶ä¸”æ”¯æŒä¸Githubï¼ŒBitbucketå’Œslackçš„é›†æˆã€‚

å’Œ Travis CI ä¸€æ ·ï¼ŒCodebeat ä¼šåœ¨ä»£ç ä»“åº“å‘ç”Ÿå˜æ›´åï¼Œæ‰§è¡Œåˆ†ææ“ä½œï¼Œå¯¹é¡¹ç›®ä»£ç è´¨é‡è¿›è¡Œè¯„åˆ†ï¼Œå¹¶åœ¨å®Œæˆååˆ·æ–°é¡¹ç›®è¯„çº§ / è¯„åˆ†çš„çŠ¶æ€æˆ–ç»“æœã€‚

[![kEr6ER.md.png](https://s2.ax1x.com/2019/01/23/kEr6ER.md.png)](https://imgchr.com/i/kEr6ER)

#### æ³¨å†Œè´¦æˆ·
è®¿é—® [CodeBeat å®˜ç½‘](https://codebeat.co/)è¿›è¡Œæ³¨å†Œï¼Œå…·ä½“å’Œ Travis CI ä¸€è‡´ï¼Œè¿™é‡Œä¸å¤šèµ˜è¿°ã€‚

CodeBeat æœåŠ¡å¯¹å¼€æºé¡¹ç›®æ˜¯å…è´¹çš„ï¼Œæ‰€ä»¥ä½ çš„ç§æœ‰é¡¹ç›®æ— æ³•äº«å—åˆ°å…è´¹çš„æŒç»­æ„å»ºæœåŠ¡ã€‚

å½“ç„¶ï¼Œæ¯æœˆæ”¯ä»˜ 20 ç¾åˆ€æˆä¸ºä»˜è´¹ç”¨æˆ·åå¯ä»¥è§£é”æ— é™æ•°é‡ç§æœ‰åº“çš„åŠŸèƒ½ã€‚

ç™»å½•å¥½è´¦å·åç‚¹å‡» `Add Repository` å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ·»åŠ å…³è”é¡¹ç›®æ¥å¼€å¯ä»£ç è´¨é‡ç®¡ç†ã€‚

åŒæ ·å…³è”æˆåŠŸä¼šåœ¨ Github è®¾ç½®é¡µé¢çš„ Webhooks ä¸­çœ‹åˆ°å…³è”ä¿¡æ¯ã€‚

![kE70Ff.png](https://s2.ax1x.com/2019/01/23/kE70Ff.png)

### GPA æŒ‡æ•°

ç‚¹å‡»å…·ä½“é¡¹ç›®è¿›å…¥å¯¹åº”çš„è¯„åˆ†ç»“æœé¡µé¢ï¼Œå¯ä»¥è¯¦ç»†æŸ¥çœ‹ Code Review ç»“æœã€‚

[![kEsCan.md.png](https://s2.ax1x.com/2019/01/23/kEsCan.md.png)](https://imgchr.com/i/kEsCan)

Codebeat è®¡ç®—å…¨å±€é¡¹ç›®å¹¶ç»™å‡ºä¸€ä¸ª GPA æŒ‡æ•°ï¼ŒèŒƒå›´0ï¼ˆæœ€å·®ï¼‰~ 4ï¼ˆæœ€ä½³ï¼‰ï¼Œå¤§è‡´æ˜ å°„åˆ°ç¾å›½GPAé‡è¡¨ã€‚

![kEs3RK.png](https://s2.ax1x.com/2019/01/23/kEs3RK.png)

> GPA æŒ‡æ•°çš„è®¡ç®—è§„åˆ™è§[å®˜æ–¹æ–‡æ¡£](https://hub.codebeat.co/docs/gpa-explained)

### Review 

ä»¥æˆ‘çš„ `AutoAlignButton` é¡¹ç›®ä¸ºä¾‹ï¼Œå®¡æŸ¥æŠ¥å‘Šä¸­ç»™ `LabelTagsViewController` è¯„çº§ä¸º `D` ğŸ˜¤ã€‚

[![kEgplV.md.png](https://s2.ax1x.com/2019/01/23/kEgplV.md.png)](https://imgchr.com/i/kEgplV)

ç‚¹å‡»è¿›å…¥æŠ¥å‘Šè¯¦æƒ…ï¼Œå¯ä»¥çœ‹åˆ°åˆ†ä¸ºä¸‰ä¸ªåˆ†ç»„ï¼š
* Complexity ä»£ç å±‚çº§è¯„ä¼°
* Duplication é‡å¤ä»£ç è¯„ä¼°
* Style ä»£ç é£æ ¼è¯„ä¼°

å¯ä»¥çœ‹åˆ°æˆ‘çš„é¡¹ç›®ä¸­ `LabelTagsViewController.m` å’Œ `CollectionTagsViewController.m` æœ‰ä¸€ä¸ª `- (NSMutableArray *)dataArr` æ–¹æ³•ä»£ç é‡å¤ï¼Œè™½ç„¶å¾ˆ MMPï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿæ˜¯å¯ä»¥ä¼˜åŒ–çš„ã€‚

![kEqFFP.png](https://s2.ax1x.com/2019/01/23/kEqFFP.png)

å¯¹åˆ†æå‡ºçš„ä»£ç è´¨é‡é—®é¢˜è¿›è¡Œä¿®æ”¹åç›´æ¥æäº¤ï¼Œï¼ŒWebhook ä¼šé€šçŸ¥ CodeBeat è¿›è¡Œåˆ·æ–°ï¼Œä»¥é‡æ–°è¿›è¡Œä»£ç è¯„åˆ†ã€‚



![kZptr6.png](https://s2.ax1x.com/2019/01/24/kZptr6.png) 

å½“ç„¶è‡ªåŠ¨åŒ–çš„ Review ä¸€å®šä¼šå‡ºç°å¯¹ä½ é«˜æ·±ä»£ç æ¶æ„çš„è¯¯è§£ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥é€‰æ‹©æ‰‹åŠ¨å¹²é¢„å®ƒçš„è®¤çŸ¥ğŸ¤£ã€‚

æ¥æ¥æ¥ï¼Œè®©æˆ‘ä»¬å¯¹æŠ¥å‘Šç»“æœè¿›è¡Œ Muteã€Reportã€Help æ“ä½œ...

å½“ç„¶è¿˜æœ‰å…¶ä»–çš„æŠ¥å‘ŠæŒ‡æ ‡ç­‰å¾…æ‚¨çš„å‘ç°ğŸ¤ªã€‚

> å®˜æ–¹æ–‡æ¡£ä¸­å…³äº[åŠŸèƒ½çº§æŒ‡æ ‡](https://hub.codebeat.co/docs/software-quality-metrics)çš„è§£é‡Š


## ğŸ˜¬  è”ç³»

* å¾®ä¿¡ : WhatsXie
* é‚®ä»¶ : ReverseScale@iCloud.com
* åšå®¢ : https://reversescale.github.io